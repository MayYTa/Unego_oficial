<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras - Unego</title>
    <link rel="stylesheet" href="css/tienda.css">
    <link rel="stylesheet" href="css/perfil.css">
    <link rel="stylesheet" href="css/carrito-de-compras.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div>
            <a href="tienda.html">
                <img class="logo" src="assets/img/unego.png" alt="Unego Logo">
            </a>
        </div>
        <div class="search-bar">
            <input type="search" id="product-search" placeholder="Buscar productos">
            <i class="fas fa-search"></i>
        </div>
        <div class="user-actions">
            <a href="carrito-de-compras.html" class="cart-icon">
                <img src="assets/icons/carrito-compras.png" alt="Carrito">
            </a>
            <i class="fas fa-bell notification-icon" id="notification-icon"></i>
            <div class="user-profile">
                <a href="perfil.html">
                    <img id="header-profile-pic" src="assets/img/default-profile.png" alt="User Profile" class="header-profile-pic">
                </a>
            </div>
        </div>
    </header>

    <main>
        <div style="max-width: 1000px; margin: 60px auto 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 32px 28px; display: flex; gap: 40px; align-items: flex-start;">
            <!-- Lista de productos -->
            <div style="flex: 2;">
                <h2 style="text-align:left; margin-bottom: 32px; color: #3498db; display: flex; align-items: center; justify-content: space-between;">
                    Carrito de Compras
                    <img src="assets/icons/carrito-compras.png" alt="Carrito" style="height: 38px; margin-left: 14px;">
                </h2>
                <!-- Producto 1: Mochila -->
                <div class="product-card publicacion" style="display: flex; align-items: center; min-height: 120px; box-shadow: none; border: 1px solid #e0e0e0; border-radius: 12px; padding: 18px; margin-bottom: 22px; position: relative;">
                    <div class="product-image" style="margin-left:0; margin-right: 22px;">
                        <img src="assets/img/mochila.png" alt="Mochila" style="width: 90px; height: 90px; object-fit: cover; border-radius: 8px;">
                    </div>
                    <div class="product-details" style="flex:1;">
                        <h3 class="product-title" style="margin:0 0 8px 0; font-size: 1.2rem;">Mochila</h3>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                            <img src="assets/img/foto-perfil1-png.png" alt="Vendedor" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 2px solid #F7FAFF; box-shadow: 0 1px 4px rgba(0,0,0,0.07);">
                            <span style="font-size: 1rem; color: #555;">Vendido por Ivan Ruben Cunyas Ramos</span>
                        </div>
                        <div class="product-price" style="font-size: 1.1rem; color: #3498db; font-weight: bold;">S/. 35</div>
                    </div>
                    <img src="assets/icons/basura.png" alt="Eliminar" class="eliminar-producto" style="width:28px; height:28px; cursor:pointer; position:absolute; right:18px; top:50%; transform:translateY(-50%);" onclick="eliminarProducto(this)">
                </div>
                <!-- Producto 2: Torta con decoración -->
                <div class="product-card publicacion" style="display: flex; align-items: center; min-height: 120px; box-shadow: none; border: 1px solid #e0e0e0; border-radius: 12px; padding: 18px; position: relative;">
                    <div class="product-image" style="margin-left:0; margin-right: 22px;">
                        <img src="assets/img/tortaConDecoracion.png" alt="Torta con decoración" style="width: 90px; height: 90px; object-fit: cover; border-radius: 8px;">
                    </div>
                    <div class="product-details" style="flex:1;">
                        <h3 class="product-title" style="margin:0 0 8px 0; font-size: 1.2rem;">Torta con decoración</h3>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                            <img src="assets/img/pasteleriaDeValeria.png" alt="Vendedor" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 2px solid #F7FAFF; box-shadow: 0 1px 4px rgba(0,0,0,0.07);">
                            <span style="font-size: 1rem; color: #555;">Vendido por Pastelería de Valeria</span>
                        </div>
                        <div class="product-price" style="font-size: 1.1rem; color: #3498db; font-weight: bold;">S/. 25</div>
                    </div>
                    <img src="assets/icons/basura.png" alt="Eliminar" class="eliminar-producto" style="width:28px; height:28px; cursor:pointer; position:absolute; right:18px; top:50%; transform:translateY(-50%);" onclick="eliminarProducto(this)">
                </div>
            </div>
            <!-- Resumen de compra -->
            <aside id="resumen-compra" style="flex: 1; background: #f7f9fd; border-radius: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.04); padding: 28px 24px; min-width: 220px;">
                <h3 style="color: #3498db; margin-top: 0; margin-bottom: 18px; font-size: 1.2rem;">Resumen</h3>
                <div id="resumen-productos">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span>Mochila</span>
                        <span>S/. 35</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 18px;">
                        <span>Torta con decoración</span>
                        <span>S/. 25</span>
                    </div>
                </div>
                <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 10px 0 0 0; width: 100%;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem; margin-top: 18px;">
                    <span>Total</span>
                    <span id="total-final">S/. 60</span>
                </div>
                <button id="finalizar-btn" style="margin-top: 28px; width: 100%; background: #3498db; color: #fff; border: none; border-radius: 6px; padding: 12px 0; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background 0.2s;">Finalizar compra</button>
            </aside>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section about">
                <img src="assets/img/unego.png" alt="Unego Logo" class="footer-logo">
                <div class="footer-text">
                    <p>Nunca es tarde para emprender ¡Empieza desde hoy!</p>
                </div>
            </div>
            <div class="footer-section links">
                <h4>Empresa</h4>
                <ul>
                    <li><a href="about_us.html">Sobre Nosotros</a></li>
                    <li><a href="universities.html">Universidades Aliadas</a></li>
                    <li><a href="q_a.html">Preguntas Frecuentes</a></li>
                </ul>
            </div>
            <div class="footer-section links">
                <h4>Producto</h4>
                <ul>
                    <li><a href="#">Catálogo</a></li>
                    <li><a href="#">Categorías</a></li>
                    <li><a href="#">Ofertas del Mes</a></li>
                </ul>
            </div>
            <div class="footer-section contact">
                <h4>Contáctanos</h4>
                <p><i class="fas fa-phone"></i> Teléfono: 01 2111111</p>
                <p><i class="fab fa-whatsapp"></i> Whatsapp: +51 999 888 777</p>
                <p><i class="fab fa-whatsapp"></i> Whatsapp: +51 999 777 665</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
            <div class="footer-section legal">
                <h4>Políticas</h4>
                <ul>
                    <li><a href="#">Condiciones</a></li>
                    <li><a href="#">Privacidad</a></li>
                    <li><a href="#">Configuración de Cookies</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 Unego | Todos los derechos reservados.
        </div>
    </footer>

    <script src="src/js/global.js" defer></script>
    <script>
function eliminarProducto(icon) {
    const card = icon.closest('.product-card.publicacion');
    if(card) card.remove();
    actualizarResumen();
}

function actualizarResumen() {
    let total = 0;
    let resumen = '';
    document.querySelectorAll('.product-card.publicacion').forEach(card => {
        const nombre = card.querySelector('.product-title').textContent.trim();
        const precioText = card.querySelector('.product-price').textContent.replace(/[^\d]/g, '');
        const precio = parseInt(precioText, 10);
        if (!isNaN(precio)) {
            total += precio;
            resumen += `<div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span>${nombre}</span>
                <span>S/. ${precio}</span>
            </div>`;
        }
    });
    const aside = document.querySelector('aside');
    if (aside) {
        const resumenDiv = aside.querySelector('#resumen-productos');
        if (resumenDiv) resumenDiv.innerHTML = resumen;
        aside.querySelector('#total-final').textContent = `S/. ${total}`;
    }
}

// Opciones de pago y resumen de compra
document.addEventListener('DOMContentLoaded', function() {
    const aside = document.getElementById('resumen-compra');
    const finalizarBtn = document.getElementById('finalizar-btn');
    finalizarBtn.addEventListener('click', function() {
        aside.innerHTML = `
            <h3 style="color: #3498db; margin-top: 0; margin-bottom: 18px; font-size: 1.2rem;">Selecciona método de pago</h3>
            <form id="form-pago">
                <div style="margin-bottom: 18px;">
                    <label style="display:block; margin-bottom:8px;">
                        <input type="radio" name="metodo" value="tarjeta" required> Tarjeta de crédito/débito
                    </label>
                    <label style="display:block; margin-bottom:8px;">
                        <input type="radio" name="metodo" value="yape"> Yape
                    </label>
                    <label style="display:block;">
                        <input type="radio" name="metodo" value="contraentrega"> Contra-entrega (coordinar con el vendedor)
                    </label>
                </div>
                <div id="campos-tarjeta" style="display:none; margin-bottom:18px;">
                    <input type="text" maxlength="12" pattern="\d{12}" placeholder="12 dígitos de tu tarjeta" style="width:100%; margin-bottom:10px; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:1rem;" required>
                    <input type="text" maxlength="5" pattern="\\d{2}/\\d{2}" placeholder="MM/AA" style="width:100%; margin-bottom:10px; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:1rem;" required>
                    <input type="text" maxlength="3" pattern="\\d{3}" placeholder="CVV" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:1rem;" required>
                </div>
                <div id="campos-yape" style="display:none; margin-bottom:18px; text-align:center;">
                    <img src="assets/img/yape.png" alt="Yape" style="width:140px; height:auto; border-radius:12px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.07);">
                </div>
                <button type="submit" style="margin-top: 10px; width: 100%; background: #3498db; color: #fff; border: none; border-radius: 6px; padding: 12px 0; font-size: 1rem; font-weight: 600; cursor: pointer;">Pagar</button>
            </form>
        `;
        // Mostrar campos de tarjeta o yape según selección
        const form = document.getElementById('form-pago');
        const camposTarjeta = form.querySelector('#campos-tarjeta');
        const camposYape = form.querySelector('#campos-yape');
        form.metodo.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'tarjeta') {
                    camposTarjeta.style.display = 'block';
                    camposTarjeta.querySelectorAll('input').forEach(inp => inp.required = true);
                    camposYape.style.display = 'none';
                } else if (this.value === 'yape') {
                    camposTarjeta.style.display = 'none';
                    camposTarjeta.querySelectorAll('input').forEach(inp => inp.required = false);
                    camposYape.style.display = 'block';
                } else {
                    camposTarjeta.style.display = 'none';
                    camposTarjeta.querySelectorAll('input').forEach(inp => inp.required = false);
                    camposYape.style.display = 'none';
                }
            });
        });
        // Validación y resumen al pagar
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            // Detecta el método de pago seleccionado
            const metodo = form.querySelector('input[name="metodo"]:checked');
            if (metodo && metodo.value === 'contraentrega') {
                window.location.href = 'chat.html';
                return;
            }
            // Oculta la parte izquierda del carrito (productos)
            const productosDiv = document.querySelector('main > div > div[style*="flex: 2"]');
            // Obtiene los productos comprados y elimina el icono de basura de cada uno
            const productosComprados = Array.from(document.querySelectorAll('.product-card.publicacion')).map(card => {
                const clone = card.cloneNode(true);
                const basura = clone.querySelector('.eliminar-producto');
                if (basura) basura.remove();
                return clone.outerHTML;
            }).join('');
            if (productosDiv) productosDiv.style.display = 'none';
            // Muestra el mensaje de gracias y los productos comprados sin el icono de basura
            aside.innerHTML = `
                <div style="text-align:center; margin-bottom:24px;">
                    <h3 style="color:#27ae60; margin-bottom:10px;">¡Gracias por tu compra!</h3>
                    <p style="color:#222; font-size:1.1rem;">Este es el resumen de tu compra.</p>
                </div>
                <div id="resumen-final-productos">
                    ${productosComprados}
                </div>
            `;
        });
    });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Busca el usuario logueado en localStorage
    const user = JSON.parse(localStorage.getItem('loggedInUser'));
    const headerProfilePic = document.getElementById('header-profile-pic');
    if (headerProfilePic) {
        if (user && user.profilePic) {
            headerProfilePic.src = user.profilePic;
        } else {
            headerProfilePic.src = 'assets/img/default-profile.png';
        }
    }
});
</script>
</body>
</html>